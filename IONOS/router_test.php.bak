<?php
// Routeur temporaire pour TEST - API LOGIN BYPASSÉE

$request_uri = $_SERVER['REQUEST_URI'];
$request_method = $_SERVER['REQUEST_METHOD'];

// Supprimer les paramètres de requête
$path = parse_url($request_uri, PHP_URL_PATH);

// Gérer les requêtes API
if (strpos($path, '/api/') === 0) {
    $api_path = substr($path, 5); // Enlever '/api/'

    if ($api_path === 'login' || $api_path === 'login.php') {
        // MODE TEST : utiliser le fichier de test qui accepte tout
        include __DIR__ . '/api/login_test.php';
        return;
    } elseif ($api_path === 'auth/login' || $api_path === 'auth/login.php') {
        include __DIR__ . '/api/login_test.php';
        return;
    } elseif ($api_path === 'test_simple.php') {
        include __DIR__ . '/api/test_simple.php';
        return;
    } elseif (strpos($api_path, 'admin') === 0) {
        include __DIR__ . '/api/admin.php';
        return;
    } elseif (strpos($api_path, 'users') === 0) {
        include __DIR__ . '/api/users.php';
        return;
    } elseif (strpos($api_path, 'content') === 0) {
        include __DIR__ . '/api/content.php';
        return;
    } else {
        http_response_code(404);
        header('Content-Type: application/json');
        echo json_encode(['error' => 'API endpoint not found']);
        return;
    }
}

// Gérer les fichiers statiques
$file_path = __DIR__ . $path;

if (is_file($file_path)) {
    return false;
}

// Pour toutes les autres routes, servir index.html (SPA)
if (file_exists(__DIR__ . '/index.html')) {
    include __DIR__ . '/index.html';
} else {
    http_response_code(404);
    echo "404 - Page not found";
}
?>
